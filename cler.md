# Clerk Integration Notes

## 1. Install the official App Router SDK

Stick with the latest App Router instructions:

```bash
npm install @clerk/nextjs
```

This installs the Next.js-specific `@clerk/nextjs` package that provides `ClerkProvider`, the React components, and the server helpers such as `clerkMiddleware()`.

## 2. Environment variables

Create a `.env.local` (ignored by git). Add placeholders onlyâ€”never commit real secrets:

```bash
# .env.local
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=YOUR_PUBLISHABLE_KEY
CLERK_SECRET_KEY=YOUR_SECRET_KEY
```

Double-check that `.gitignore` already blocks `.env*` files so keys stay local.

## 3. Middleware

Create or update `middleware.ts` at the project root (or `src` if you already use `src`). It must import and use `clerkMiddleware()` from `@clerk/nextjs/server` exactly as shown in the Clerk quickstart:

```typescript
// middleware.ts

import { clerkMiddleware } from "@clerk/nextjs/server";

export default clerkMiddleware();

export const config = {
  matcher: [
    "/((?!_next|[^?]*\\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)",
    "/(api|trpc)(.*)",
  ],
};
```

If you already have additional middleware (for example, i18n routing), `clerkMiddleware()` should run alongside or compose with it so both concerns execute.

## 4. Layout

Wrap your App Router root in `<ClerkProvider>` inside `app/layout.tsx` (or `src/app/layout.tsx`), and import Clerk components from `@clerk/nextjs`. The Header snippet below matches the quickstart pattern:

```typescript
// app/layout.tsx

import type { Metadata } from "next";
import {
  ClerkProvider,
  SignInButton,
  SignUpButton,
  SignedIn,
  SignedOut,
  UserButton,
} from "@clerk/nextjs";
import "./globals.css";

export const metadata: Metadata = {
  title: "Clerk Next.js Quickstart",
  description: "Generated by create next app",
};

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <ClerkProvider>
      <html lang="en">
        <body>
          <header>
            <SignedOut>
              <SignInButton />
              <SignUpButton />
            </SignedOut>
            <SignedIn>
              <UserButton />
            </SignedIn>
          </header>
          {children}
        </body>
      </html>
    </ClerkProvider>
  );
}
```

`ClerkProvider` must wrap the entire App Router tree so signed-in state and authentication helpers are available everywhere.

## 5. Using Clerk components

Anywhere in the App Router you can import and render Clerk components from `@clerk/nextjs`. Common patterns include `<SignInButton>`, `<SignUpButton>`, `<UserButton>`, `<SignedIn>`, and `<SignedOut>` to show auth-aware UI.

## 6. Verification checklist

- `middleware.ts` calls `clerkMiddleware()` from `@clerk/nextjs/server`.
- `app/layout.tsx` (App Router root) wraps everything with `<ClerkProvider>`.
- Clerk imports come exclusively from `@clerk/nextjs` or `@clerk/nextjs/server`.
- No `_app.tsx` or `pages/` files are referenced; stick to App Router folders.
- Environment variables use placeholders and remain in `.env.local`.
- `.gitignore` excludes `.env*` so keys never enter version control.

Following these steps keeps the project aligned with the current Clerk App Router quickstart instructions.

